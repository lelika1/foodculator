<html>

<head>
    <title>Foodculator 1.0</title>
    <link rel="icon" href="/static/icon.svg">
</head>

<body onload="loadFunction()">

    <h1>Create a new recipe:</h1>

    <h3>Add all ingredients:</h3>
    <input list="ingredients">
    <datalist id="ingredients"></datalist>
    <input type="number" min="0" max="10000" value="0" id="gram">
    <button>Add to recipe</button><br>

    <h3>Recipe's ingredients:</h3>
    <div id="recipe">
    </div>

    <h3>Choose a pot:</h3>
    <div id="tableware">
    </div>

    <h3>Input total weight:</h3>
    <input type="number" min="1" max="10000" value="1" id="total_weight">
    <label for="total_weight">grams</label><br><br>

    <button id="calculate"> Calculate food energy </button>

    <script>
        function loadFunction() {
            getProducts()
            getTableware()
        }

        function getProducts() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var list = document.getElementById("ingredients")
                    var obj = JSON.parse(this.responseText);
                    for (i = 0; i < obj.products.length; i++) {
                        var option = document.createElement("option");
                        option.text = obj.products[i].name + "\t" + obj.products[i].kcal
                        list.appendChild(option)
                    }
                }
            };

            xhttp.open("POST", "/get_ingredients", true);
            xhttp.send();
        }

        function addItemToTableware(id, name, checked, text) {
            var div = document.getElementById("tableware")
            var radio = document.createElement("input");
            radio.type = 'radio';
            radio.id = id;
            radio.name = name;
            radio.checked = checked;
            div.appendChild(radio);

            var label = document.createElement("label");
            label.for = id;
            label.appendChild(document.createTextNode(text));
            div.appendChild(label);
            div.appendChild(document.createElement("br"));
        }

        function getTableware() {
            addItemToTableware('pod0', 'tableware', true, "None");

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var list = document.getElementById("tableware")
                    var obj = JSON.parse(this.responseText);
                    for (i = 0; i < obj.tableware.length; i++) {
                        var t = obj.tableware[i].name + "\t" + obj.tableware[i].weight + " g";
                        addItemToTableware('pot' + (i + 1), 'tableware', false, t);
                    }
                }
            };

            xhttp.open("POST", "/get_tableware", true);
            xhttp.send();
        }

    </script>
</body>

</html>