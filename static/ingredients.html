<html>

<head>
    <title>Foodculator 1.0</title>
    <link rel="icon" href="/static/icon.svg">
</head>

<body onload="getProductsFunction()">
    <h1>All products:</h1>
    <select id="ingredients"></select>

    <h1>Add a new product</h1>
    <label>Product:</label>
    <input type="text" id="product"><br><br>

    <label>kcal:</label>
    <input type="number" min="0" max="10000" value="0" id="kcal">
    <label>for 100g</label><br><br>
    <input type="submit" value="Submit" onclick="addProduct()"><br><br>

    <label id="response"></label>
</body>

<script>
    function addProduct() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            document.getElementById("response").innerHTML = this.responseText;
            if (this.readyState == 4 && this.status == 200) {
                var option = document.createElement("option");
                option.text = document.getElementById("product").value
                    + "\t" + document.getElementById("kcal").value + " kcal"
                document.getElementById("ingredients").add(option)

                document.getElementById("product").value = ''
                document.getElementById("kcal").value = '0'
            }
        };

        xhttp.open("POST", "/add_ingredient", true);
        var body = "product=" + document.getElementById("product").value
        body = body + "&kcal=" + document.getElementById("kcal").value
        xhttp.send(body);
    }

    function getProductsFunction() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var list = document.getElementById("ingredients")
                var obj = JSON.parse(this.responseText);
                for (i = 0; i < obj.products.length; i++) {
                    var option = document.createElement("option");
                    option.text = obj.products[i].name + "\t" + obj.products[i].kcal + " kcal"
                    list.add(option)
                }
            }
        };
        xhttp.open("POST", "/get_ingredients", true);
        xhttp.send();
    }
</script>

</html>