<html>

<head>
    <title>Foodculator 1.0</title>
    <link rel="icon" href="/static/icon.svg">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body onload="getTableware()">
    <h1>All pans and pots:</h1>
    <select id="tableware"></select>

    <h1>Add new</h1>
    <label for="name">Name:</label>
    <input type="text" id="name"><br><br>

    <label for="weight">Weight:</label>
    <input type="number" min="0" max="10000" value="0" id="weight" onkeydown="callOnEnter(addTableware)">
    <label for="weight">grams</label><br><br>

    <input type="submit" value="Submit" onclick="addTableware()">
    <label id="twNameResponse" style="font-weight: bold; color: green; font-style: italic"></label>
    <label id="response"></label>
</body>


<script>
    function callOnEnter(fn) {
        if (event.key === 'Enter') {
            fn();
        }
    }

    function addTableware() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4) {
                if (this.status == 200) {
                    $("#tableware").append($("<option>")
                        .text(`${$("#name").val()} ${$("#weight").val()} g`));

                    $("#twNameResponse").text($("#name").val());
                    $("#response").text(" successfully added.").attr("style", "color:green;");

                    $("#weight").val(0);
                    $("#name").val('').focus();
                } else {
                    $("#twNameResponse").text("");
                    $("#response").text(this.responseText).attr("style", "color:red;");
                }
            }
        };

        xhttp.open("POST", "/add_tableware", true);
        xhttp.send(JSON.stringify({
            "name": $("#name").val(),
            "weight": parseInt($("#weight").val())
        }));
    }

    function getTableware() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                JSON.parse(this.responseText).forEach(tw => {
                    $("#tableware").append($("<option>").text(`${tw.name} ${tw.weight} g`));
                });
            }
        }

        xhttp.open("GET", "/get_tableware", true);
        xhttp.send();
    }
</script>

</html>